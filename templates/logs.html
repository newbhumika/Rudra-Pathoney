{% extends 'base.html' %}
{% block content %}
<!-- Header Section -->
<div class="row mb-4">
	<div class="col-12">
		<div class="d-flex justify-content-between align-items-center">
			<div>
				<h1 class="text-gradient mb-2">
					<i class="fas fa-list-alt text-primary me-2"></i>
					Attack Logs
				</h1>
				<p class="text-muted mb-0">Real-time monitoring of all honeypot activities and attack attempts</p>
			</div>
			<div class="d-flex align-items-center gap-2">
				<span class="badge bg-success">
					<i class="fas fa-circle me-1"></i>Live Monitoring
				</span>
				<button class="btn btn-outline-primary btn-sm" onclick="refreshLogs()">
					<i class="fas fa-sync-alt me-1"></i>Refresh
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Advanced Filters -->
<div class="card mb-4 animate-fade-in">
	<div class="card-header">
		<h5 class="mb-0">
			<i class="fas fa-filter text-info me-2"></i>
			Advanced Filters
		</h5>
	</div>
	<div class="card-body">
		<div class="row g-3">
			<div class="col-12 col-md-6 col-lg-3">
				<label class="form-label">
					<i class="fas fa-globe me-1"></i>Attacker IP
				</label>
				<input type="text" class="form-control" id="filter-ip" placeholder="e.g. 192.168.1.1">
			</div>
			<div class="col-12 col-md-6 col-lg-3">
				<label class="form-label">
					<i class="fas fa-clock me-1"></i>Time Range
				</label>
				<select class="form-select" id="filter-hours">
					<option value="1">Last 1 hour</option>
					<option value="6">Last 6 hours</option>
					<option value="24" selected>Last 24 hours</option>
					<option value="168">Last 7 days</option>
					<option value="720">Last 30 days</option>
					<option value="">All time</option>
				</select>
			</div>
			<div class="col-12 col-md-6 col-lg-3">
				<label class="form-label">
					<i class="fas fa-terminal me-1"></i>Command Keyword
				</label>
				<input type="text" class="form-control" id="filter-command" placeholder="e.g. wget, curl, bash">
			</div>
			<div class="col-12 col-md-6 col-lg-3">
				<label class="form-label">
					<i class="fas fa-search me-1"></i>Global Search
				</label>
				<input type="text" class="form-control" id="filter-q" placeholder="Search across all fields">
			</div>
		</div>
		<div class="row mt-3">
			<div class="col-12">
				<div class="d-flex flex-wrap gap-2 align-items-center">
					<button class="btn btn-primary" id="apply-filters">
						<i class="fas fa-search me-1"></i>Apply Filters
					</button>
					<button class="btn btn-outline-secondary" onclick="clearFilters()">
						<i class="fas fa-times me-1"></i>Clear All
					</button>
					<div class="form-check form-switch ms-3">
						<input class="form-check-input" type="checkbox" id="auto-refresh" checked>
						<label class="form-check-label" for="auto-refresh">
							<i class="fas fa-sync-alt me-1"></i>Auto-refresh
						</label>
					</div>
					<div class="ms-auto">
						<a class="btn btn-outline-success" id="exportCsvLink" href="#">
							<i class="fas fa-download me-1"></i>Export CSV
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Quick Stats -->
<div class="row g-3 mb-4">
	<div class="col-12 col-md-3">
		<div class="card text-center animate-fade-in" style="animation-delay: 0.1s;">
			<div class="card-body">
				<i class="fas fa-exclamation-triangle text-danger fa-2x mb-2"></i>
				<h4 class="text-danger mb-1" id="total-logs">--</h4>
				<small class="text-muted">Total Logs</small>
			</div>
		</div>
	</div>
	<div class="col-12 col-md-3">
		<div class="card text-center animate-fade-in" style="animation-delay: 0.2s;">
			<div class="card-body">
				<i class="fas fa-globe text-warning fa-2x mb-2"></i>
				<h4 class="text-warning mb-1" id="unique-ips-logs">--</h4>
				<small class="text-muted">Unique IPs</small>
			</div>
		</div>
	</div>
	<div class="col-12 col-md-3">
		<div class="card text-center animate-fade-in" style="animation-delay: 0.3s;">
			<div class="card-body">
				<i class="fas fa-key text-info fa-2x mb-2"></i>
				<h4 class="text-info mb-1" id="login-attempts">--</h4>
				<small class="text-muted">Login Attempts</small>
			</div>
		</div>
	</div>
	<div class="col-12 col-md-3">
		<div class="card text-center animate-fade-in" style="animation-delay: 0.4s;">
			<div class="card-body">
				<i class="fas fa-terminal text-success fa-2x mb-2"></i>
				<h4 class="text-success mb-1" id="commands-executed">--</h4>
				<small class="text-muted">Commands</small>
			</div>
		</div>
	</div>
</div>

<!-- Logs Table -->
<div class="card animate-fade-in" style="animation-delay: 0.5s;">
	<div class="card-header d-flex justify-content-between align-items-center">
		<h5 class="mb-0">
			<i class="fas fa-table text-primary me-2"></i>
			Attack Logs
		</h5>
		<div class="d-flex align-items-center gap-2">
			<small class="text-muted">Showing <span id="logs-count">0</span> entries</small>
			<div class="dropdown">
				<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
					<i class="fas fa-cog me-1"></i>Options
				</button>
				<ul class="dropdown-menu">
					<li><a class="dropdown-item" href="#" onclick="toggleColumn('timestamp')">Toggle Timestamp</a></li>
					<li><a class="dropdown-item" href="#" onclick="toggleColumn('analysis')">Toggle Analysis</a></li>
					<li><hr class="dropdown-divider"></li>
					<li><a class="dropdown-item" href="#" onclick="exportLogs('json')">Export as JSON</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="card-body p-0">
		<div class="table-responsive">
			<table id="logsTable" class="table table-dark table-hover mb-0">
				<thead class="table-dark">
					<tr>
						<th class="text-center">
							<i class="fas fa-clock me-1"></i>Timestamp
						</th>
						<th>
							<i class="fas fa-globe me-1"></i>Attacker IP
						</th>
						<th>
							<i class="fas fa-user me-1"></i>Username
						</th>
						<th>
							<i class="fas fa-key me-1"></i>Password
						</th>
						<th>
							<i class="fas fa-terminal me-1"></i>Command
						</th>
						<th>
							<i class="fas fa-link me-1"></i>Session
						</th>
						<th>
							<i class="fas fa-tag me-1"></i>Event
						</th>
						<th class="text-center">
							<i class="fas fa-shield-alt me-1"></i>Analysis
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td colspan="8" class="text-center py-5">
							<div class="spinner-border text-primary" role="status">
								<span class="visually-hidden">Loading...</span>
							</div>
							<p class="mt-2 text-muted">Loading attack logs...</p>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>

<!-- Threat Analysis Panel -->
<div class="row mt-4">
	<div class="col-12">
		<div class="card animate-fade-in" style="animation-delay: 0.6s;">
			<div class="card-header">
				<h5 class="mb-0">
					<i class="fas fa-brain text-warning me-2"></i>
					Threat Analysis Summary
				</h5>
			</div>
			<div class="card-body">
				<div class="row g-3">
					<div class="col-12 col-md-4">
						<div class="alert alert-warning">
							<h6 class="alert-heading">
								<i class="fas fa-exclamation-triangle me-1"></i>
								High Risk Commands
							</h6>
							<div id="high-risk-commands">
								<small class="text-muted">Analyzing commands...</small>
							</div>
						</div>
					</div>
					<div class="col-12 col-md-4">
						<div class="alert alert-danger">
							<h6 class="alert-heading">
								<i class="fas fa-ban me-1"></i>
								Suspicious IPs
							</h6>
							<div id="suspicious-ips">
								<small class="text-muted">Analyzing IPs...</small>
							</div>
						</div>
					</div>
					<div class="col-12 col-md-4">
						<div class="alert alert-info">
							<h6 class="alert-heading">
								<i class="fas fa-chart-line me-1"></i>
								Attack Patterns
							</h6>
							<div id="attack-patterns">
								<small class="text-muted">Analyzing patterns...</small>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
// Logs page specific JavaScript
function refreshLogs() {
	// Add loading state to table
	const tbody = document.querySelector('#logsTable tbody');
	tbody.innerHTML = `
		<tr>
			<td colspan="8" class="text-center py-3">
				<div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
				Refreshing logs...
			</td>
		</tr>
	`;
	
	// Trigger table refresh
	if (window.logsDataTable) {
		window.logsDataTable.ajax.reload();
	}
}

function clearFilters() {
	document.getElementById('filter-ip').value = '';
	document.getElementById('filter-hours').value = '24';
	document.getElementById('filter-command').value = '';
	document.getElementById('filter-q').value = '';
	
	// Apply cleared filters
	if (window.logsDataTable) {
		window.logsDataTable.ajax.reload();
	}
}

function toggleColumn(columnName) {
	// Column visibility toggle logic
	console.log(`Toggling column: ${columnName}`);
}

function exportLogs(format) {
	// Export functionality
	console.log(`Exporting logs as: ${format}`);
}

// Update quick stats
function updateLogStats(data) {
	const totalLogs = data.total || 0;
	const uniqueIPs = new Set(data.data?.map(log => log.attacker_ip)).size || 0;
	const loginAttempts = data.data?.filter(log => log.event === 'login').length || 0;
	const commands = data.data?.filter(log => log.command).length || 0;
	
	document.getElementById('total-logs').textContent = totalLogs.toLocaleString();
	document.getElementById('unique-ips-logs').textContent = uniqueIPs.toLocaleString();
	document.getElementById('login-attempts').textContent = loginAttempts.toLocaleString();
	document.getElementById('commands-executed').textContent = commands.toLocaleString();
	document.getElementById('logs-count').textContent = data.data?.length || 0;
}

// Initialize logs page
document.addEventListener('DOMContentLoaded', function() {
	// Add animation delays to cards
	document.querySelectorAll('.card').forEach((card, index) => {
		card.style.animationDelay = `${index * 0.1}s`;
	});
});
</script>
{% endblock %}
